---
phase: 03-state-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/stores/leagues.js
  - app/composables/useRoundLookup.js
  - app/composables/usePhaseLookup.js
  - app/composables/usePairings.js
  - app/composables/useStandings.js
  - app/composables/useArmyForm.js
  - app/composables/useMatchResults.js
autonomous: true

must_haves:
  truths:
    - "Pinia store state uses 'phase' terminology (currentPhase, joinedPhase, leftPhase)"
    - "Store getters filter by phase property, not round property"
    - "Composables use phase naming in function names and parameters"
    - "Store fetches data from API endpoints and properties work correctly"
  artifacts:
    - path: "app/stores/leagues.js"
      provides: "Pinia store with phase terminology"
      contains: "currentPhase"
    - path: "app/composables/usePhaseLookup.js"
      provides: "Phase lookup composable (renamed from useRoundLookup)"
      exports: ["usePhaseLookup", "getPhaseName", "getPhaseLimit"]
    - path: "app/composables/usePairings.js"
      provides: "Pairings composable with phase terminology"
      contains: "joinedPhase"
    - path: "app/composables/useMatchResults.js"
      provides: "Match results composable with getPhaseMatches"
      contains: "getPhaseMatches"
  key_links:
    - from: "app/stores/leagues.js"
      to: "API response properties"
      via: "Property access in getters"
      pattern: "currentLeague\\.currentPhase|p\\.phase|a\\.phase"
    - from: "app/composables/usePairings.js"
      to: "Player objects from store"
      via: "joinedPhase/leftPhase properties"
      pattern: "p\\.joinedPhase|p\\.leftPhase"
---

<objective>
Rename round terminology to phase across Pinia store and Vue composables.

Purpose: Complete the state management layer of the round->phase rename, ensuring frontend state matches the API response shapes updated in Phase 2.

Output: Updated leagues.js store and 5 composable files using consistent phase terminology.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-state-management/03-RESEARCH.md
@app/stores/leagues.js
@app/composables/useRoundLookup.js
@app/composables/usePairings.js
@app/composables/useStandings.js
@app/composables/useArmyForm.js
@app/composables/useMatchResults.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Pinia store (leagues.js)</name>
  <files>app/stores/leagues.js</files>
  <action>
Update all round->phase terminology in the leagues store:

**Getters to update:**

1. `paintingLeaderboard` (line ~92-95):
   - `const currentRound = this.currentLeague.currentRound || 1` -> `const currentPhase = this.currentLeague.currentPhase || 1`
   - `a.round === currentRound` -> `a.phase === currentPhase`

2. `currentRoundPairings` -> rename to `currentPhasePairings` (line ~156-160):
   - Getter name: `currentRoundPairings` -> `currentPhasePairings`
   - `const currentRound = this.currentLeague.currentRound || 1` -> `const currentPhase = this.currentLeague.currentPhase || 1`
   - `p.round === currentRound` -> `p.phase === currentPhase`

3. `unpairedPlayersCount` (line ~163-181):
   - `const currentRound = this.currentLeague.currentRound || 1` -> `const currentPhase = this.currentLeague.currentPhase || 1`
   - `(p.joinedRound || 1) <= currentRound` -> `(p.joinedPhase || 1) <= currentPhase`
   - `(!p.leftRound || p.leftRound >= currentRound)` -> `(!p.leftPhase || p.leftPhase >= currentPhase)`
   - `.filter(p => p.round === currentRound)` -> `.filter(p => p.phase === currentPhase)`

4. `activePlayers` (line ~184-192):
   - `const currentRound = this.currentLeague.currentRound || 1` -> `const currentPhase = this.currentLeague.currentPhase || 1`
   - `(p.joinedRound || 1) <= currentRound` -> `(p.joinedPhase || 1) <= currentPhase`
   - `(!p.leftRound || p.leftRound >= currentRound)` -> `(!p.leftPhase || p.leftPhase >= currentPhase)`

**Actions to update:**

5. `saveArmy` (line ~957-959):
   - `a.playerId === army.playerId && a.round === army.round` -> `a.playerId === army.playerId && a.phase === army.phase`

6. `deleteArmy` (line ~977-988):
   - Parameter: `round` -> `phase`
   - URL: `&round=${round}` -> `&phase=${phase}`
   - Filter: `a.round === round` -> `a.phase === phase`

7. `togglePlayerActive` (line ~1140-1147):
   - Parameter: `currentRound` -> `currentPhase`
   - Body: `{ isActive, currentRound }` -> `{ isActive, currentPhase }`

**IMPORTANT - Do NOT change:**
- `firstRoundPairingMethod` or `subsequentRoundMethod` in leagueSettings references (these are tournament pairing method settings, not phase terminology)
- `Math.round()` calls (JavaScript math function)
- Any comments that use "round" as a verb meaning "to round a number"
  </action>
  <verify>
Run `grep -n "currentRound\|joinedRound\|leftRound\|\.round" app/stores/leagues.js` and verify:
- No matches except in comments or string literals like "Round ${roundNumber}"
- `Math.round` calls are preserved
- `firstRoundPairingMethod` and `subsequentRoundMethod` are preserved
  </verify>
  <done>
Store uses `currentPhase`, `joinedPhase`, `leftPhase`, and `.phase` property access throughout. Getter `currentPhasePairings` renamed. Action parameters use `currentPhase`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update composables (5 files)</name>
  <files>
app/composables/useRoundLookup.js
app/composables/usePhaseLookup.js
app/composables/usePairings.js
app/composables/useStandings.js
app/composables/useArmyForm.js
app/composables/useMatchResults.js
  </files>
  <action>
**1. Rename and update useRoundLookup.js -> usePhaseLookup.js:**

Create new file `app/composables/usePhaseLookup.js` with renamed content:
- Function name: `useRoundLookup` -> `usePhaseLookup`
- Parameter: `rounds` -> `phases`
- Functions to rename:
  - `getRoundName` -> `getPhaseName`
  - `getRoundLimit` -> `getPhaseLimit`
  - `getRound` -> `getPhase`
  - `getCurrentRound` -> `getCurrentPhase`
  - `roundExists` -> `phaseExists`
  - `getSortedRounds` -> `getSortedPhases`
  - `getRoundByDate` -> `getPhaseByDate`
- Internal variable names: `round` -> `phase`, `rounds` -> `phases`
- JSDoc comments: update "round" -> "phase" terminology
- Default return strings: `Round ${roundNumber}` -> `Phase ${phaseNumber}`

Then delete the old `app/composables/useRoundLookup.js` file.

**2. Update usePairings.js:**

- `getActivePlayers` function (line ~19-26):
  - `(p.joinedRound || 1) <= round` -> `(p.joinedPhase || 1) <= phase`
  - `(!p.leftRound || p.leftRound >= round)` -> `(!p.leftPhase || p.leftPhase >= phase)`
- All JSDoc comments: update parameter descriptions from "Round number" to "Phase number"
- Internal variable names where appropriate: `round` parameter name can stay as-is since it's descriptive of the concept, but property access must use `joinedPhase`/`leftPhase`

**3. Update useStandings.js:**

- `calculateStandings` function (line ~184):
  - Parameter `round` can stay as-is (descriptive name)
  - No property access changes needed (this file uses player stats, not phase properties)
- JSDoc comments: update "Round number" -> "Phase number" in descriptions

**4. Update useArmyForm.js:**

- `currentArmy` ref initial state (line ~16-24):
  - `round: null` -> `phase: null`
- `currentRoundLimit` computed (line ~30-34):
  - Rename to `currentPhaseLimit`
  - `currentArmy.value.round` -> `currentArmy.value.phase`
- `startNewArmy` function (line ~56-68):
  - Parameter: `defaultRound` -> `defaultPhase`
  - Property: `round: defaultRound` -> `phase: defaultPhase`
- `cancelBuilder` function (line ~84-95):
  - Property: `round: null` -> `phase: null`
- `copyFromPreviousArmy` function (line ~156-162):
  - String: `Round ${currentArmy.value.round}` -> `Phase ${currentArmy.value.phase}`
- Return object: `currentRoundLimit` -> `currentPhaseLimit`

**5. Update useMatchResults.js:**

- `getRoundMatches` function (line ~214-218):
  - Rename to `getPhaseMatches`
  - Parameter: `roundNumber` -> `phaseNumber`
  - Filter: `match.round === roundNumber` -> `match.phase === phaseNumber`
- JSDoc: update "Round number" -> "Phase number"
- Return object: `getRoundMatches` -> `getPhaseMatches`
  </action>
  <verify>
1. Run `ls app/composables/usePhaseLookup.js` to confirm new file exists
2. Run `ls app/composables/useRoundLookup.js 2>/dev/null || echo "Old file deleted"` to confirm old file deleted
3. Run `grep -n "joinedRound\|leftRound\|\.round" app/composables/usePairings.js` and verify no matches
4. Run `grep -n "currentRoundLimit\|getRoundMatches\|useRoundLookup" app/composables/` and verify no matches except in comments
5. Run `npm run build` or `nuxt build` to verify no TypeScript/compilation errors
  </verify>
  <done>
- usePhaseLookup.js created with all functions renamed (getPhaseName, getPhaseLimit, etc.)
- useRoundLookup.js deleted
- usePairings.js uses joinedPhase/leftPhase property access
- useArmyForm.js uses phase property and currentPhaseLimit computed
- useMatchResults.js exports getPhaseMatches
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Grep verification** - No remaining round terminology in modified files:
```bash
grep -rn "currentRound\|joinedRound\|leftRound" app/stores/leagues.js app/composables/usePairings.js app/composables/useStandings.js app/composables/useArmyForm.js app/composables/useMatchResults.js | grep -v "firstRoundPairingMethod\|subsequentRoundMethod\|Math.round"
```
Should return no results.

2. **Build verification**:
```bash
npm run build
```
Should complete without errors.

3. **File existence check**:
```bash
ls app/composables/usePhaseLookup.js && echo "New composable exists"
ls app/composables/useRoundLookup.js 2>/dev/null || echo "Old composable deleted"
```
</verification>

<success_criteria>
1. Pinia store uses `currentPhase`, `joinedPhase`, `leftPhase` property access
2. Store getter renamed from `currentRoundPairings` to `currentPhasePairings`
3. Store action `togglePlayerActive` takes `currentPhase` parameter
4. `usePhaseLookup.js` exists with renamed functions (getPhaseName, getPhaseLimit, etc.)
5. `useRoundLookup.js` deleted
6. All 5 composables use phase terminology in property access and function names
7. Build passes with no errors
8. Edge cases preserved: `firstRoundPairingMethod`, `subsequentRoundMethod`, `Math.round()`
</success_criteria>

<output>
After completion, create `.planning/phases/03-state-management/03-01-SUMMARY.md`
</output>

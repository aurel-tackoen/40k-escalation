---
phase: 04-user-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/composables/useArmyFiltering.js
  - app/components/views/ArmyListsView.vue
  - app/pages/armies.vue
  - app/components/views/PlayersView.vue
  - app/pages/players.vue
  - app/components/views/PairingsView.vue
  - app/components/views/MatchesView.vue
autonomous: true

must_haves:
  truths:
    - "Component props use phase terminology (currentPhase, phases)"
    - "Composable exports use phase terminology (selectedPhase, setPhaseFilter)"
    - "Parent pages pass phase props correctly"
    - "Application compiles without errors"
  artifacts:
    - path: "app/composables/useArmyFiltering.js"
      provides: "Phase-named exports"
      exports: ["selectedPhase", "setPhaseFilter", "getArmyCountForPhase"]
    - path: "app/components/views/ArmyListsView.vue"
      provides: "Phase-named props"
      contains: "currentPhase"
    - path: "app/components/views/PlayersView.vue"
      provides: "Phase-named prop"
      contains: "currentPhase"
  key_links:
    - from: "app/pages/armies.vue"
      to: "app/components/views/ArmyListsView.vue"
      via: ":current-phase prop binding"
      pattern: ":current-phase"
    - from: "app/components/views/ArmyListsView.vue"
      to: "app/composables/useArmyFiltering.js"
      via: "destructured import"
      pattern: "selectedPhase.*useArmyFiltering"
---

<objective>
Update component props, composable exports, and their consumers to use "phase" terminology.

Purpose: Props and composable exports must be renamed WITH their consumers simultaneously to avoid broken imports/bindings. This is the foundation for Phase 4 - all internal component references depend on correct prop names.

Output: Components receive phase-named props from parents, composables export phase-named functions/refs.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-state-management/03-01-SUMMARY.md
@.planning/phases/04-user-interface/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update useArmyFiltering composable exports AND ArmyListsView consumer</name>
  <files>
    app/composables/useArmyFiltering.js
    app/components/views/ArmyListsView.vue
    app/pages/armies.vue
  </files>
  <action>
**useArmyFiltering.js changes:**
1. Rename ref: `selectedRound` -> `selectedPhase` (line 13)
2. Update JSDoc comment: "Handles player and round filters" -> "Handles player and phase filters" (line 5)
3. Update comment: "Filters by round and player" -> "Filters by phase and player" (line 18)
4. Update comment: "Sort by round (desc)" -> "Sort by phase (desc)" (line 34)
5. Rename function: `getArmyCountForRound` -> `getArmyCountForPhase` (line 47)
6. Update JSDoc: "@param {number} roundNumber - Round number" -> "@param {number} phaseNumber - Phase number" (line 45)
7. Update parameter name: `roundNumber` -> `phaseNumber` (line 47)
8. Rename function: `setRoundFilter` -> `setPhaseFilter` (line 63)
9. Update JSDoc: "@param {number|string} round - Round number" -> "@param {number|string} phase - Phase number" (line 61)
10. Update parameter name: `round` -> `phase` (line 63)
11. Update return object exports: `selectedRound` -> `selectedPhase`, `getArmyCountForRound` -> `getArmyCountForPhase`, `setRoundFilter` -> `setPhaseFilter` (lines 85, 93, 95)

**ArmyListsView.vue script changes:**
1. Update props definition (lines 42-49):
   - `currentRound` -> `currentPhase`
   - `rounds` -> `phases`
2. Update usePhaseLookup call (line 68): `toRef(props, 'rounds')` -> `toRef(props, 'phases')`
3. Update useArmyManagement call (line 101): `toRef(props, 'rounds')` -> `toRef(props, 'phases')`
4. Update useArmyForm call (line 126): `toRef(props, 'rounds')` -> `toRef(props, 'phases')`
5. Update destructured imports from useArmyFiltering (lines 132-136):
   - `selectedRound` -> `selectedPhase`
   - `getArmyCountForRound` -> `getArmyCountForPhase`
6. Update handleStartNewArmy function (line 208): `props.currentRound` -> `props.currentPhase`
7. Update pre-fill army name (line 216): `Round ${props.currentRound}` -> `Phase ${props.currentPhase}` (this is user-visible text in the default name)

**armies.vue page changes:**
1. Update prop bindings (lines 18-19):
   - `:current-round="league.currentRound"` -> `:current-phase="league.currentPhase"`
   - `:rounds="league.rounds"` -> `:phases="league.phases"`

NOTE: The store already returns `currentPhase` and `phases` (verified in Phase 3).
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Grep for remaining "currentRound" in these 3 files - should find none.
  </verify>
  <done>
useArmyFiltering exports phase-named functions/refs, ArmyListsView receives phase-named props, armies.vue passes phase data correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update PlayersView props and consumers</name>
  <files>
    app/components/views/PlayersView.vue
    app/pages/players.vue
  </files>
  <action>
**PlayersView.vue changes:**
1. Update prop definition (lines 25-28):
   ```javascript
   currentRound: {
     type: Number,
     default: 1
   }
   ```
   Change to:
   ```javascript
   currentPhase: {
     type: Number,
     default: 1
   }
   ```
2. Update togglePlayerActive call (line 131-135): `props.currentRound` -> `props.currentPhase`
3. Update toast message (line 138-139):
   - `Round ${props.currentRound}+` -> `Phase ${props.currentPhase}+`
   - `Round ${props.currentRound}` -> `Phase ${props.currentPhase}`
4. Update getPlayerPaintingStats calls (lines 331, 336, 340, 341):
   All instances of `currentRound` parameter -> `currentPhase`
5. Update "No army data" message (line 346): "No army data for current round" -> "No army data for current phase"

**players.vue page changes:**
1. Update prop binding (line 23):
   `:currentRound="league?.currentRound || 1"` -> `:currentPhase="league?.currentPhase || 1"`
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Grep for "currentRound" in these 2 files - should find none.
  </verify>
  <done>
PlayersView receives currentPhase prop, players.vue passes phase data correctly, painting stats use currentPhase.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update PairingsView and MatchesView internal refs</name>
  <files>
    app/components/views/PairingsView.vue
    app/components/views/MatchesView.vue
  </files>
  <action>
**PairingsView.vue changes:**
1. Update ref comment (line 29): "Selected round (defaults to current round)" -> "Selected phase (defaults to current phase)"
2. Rename ref (line 30): `selectedRound` -> `selectedPhase`
3. Update watch callback (lines 33-36):
   - `league?.currentRound` -> `league?.currentPhase`
   - `selectedRound.value` -> `selectedPhase.value`
4. Update roundOptions computed (lines 67-75):
   - Access: `currentLeague.value.rounds` -> `currentLeague.value.phases` (line 68)
   - Return label: `Round ${r.number}` -> `Phase ${r.number}` (line 73)
5. Rename computed: `selectedRoundPairings` -> `selectedPhasePairings` (line 77)
6. Update filter logic (line 79): `p.round === selectedRound.value` -> `p.phase === selectedPhase.value`
7. Rename computed: `selectedRoundUnpairedCount` -> `selectedPhaseUnpairedCount` (line 82)
8. Update references in computed (lines 83-90): all `selectedRound` -> `selectedPhase`, all `selectedRoundPairings` -> `selectedPhasePairings`
9. Update unpairedPlayers computed (lines 93-96): `selectedRound` -> `selectedPhase`
10. Update suggestedMethod computed (lines 98-101): `selectedRound` -> `selectedPhase`
11. Rename function: `changeRound` -> `changePhase` (line 104) - but keep function body as is since it just sets selectedPhase
12. Update all method references from `selectedRound` to `selectedPhase` (throughout file)
13. Update template v-model bindings: `selectedRound` -> `selectedPhase`
14. Update toast message (line 191): `Round ${selectedRound.value}` -> `Phase ${selectedPhase.value}`
15. Update confirmation modal title (line 480): `Round ${selectedRound}` -> `Phase ${selectedPhase}`
16. Update confirmation modal message (line 481): replace `round` references

**MatchesView.vue changes:**
1. Rename computed (line 33): `leagueRounds` -> `leaguePhases`
2. Update computed source (line 33): `currentLeague.value?.rounds` -> `currentLeague.value?.phases`
3. Update newMatch.round references - these stay as `round` since the API still uses `round` field for match records. HOWEVER, the form LABEL should change.
4. In template, update the filter dropdown v-for (line 375): `round in leagueRounds` -> `phase in leaguePhases`
5. Update form field label (line 821): "Round" -> "Phase"
6. Update select v-for (line 824): `round in leagueRounds` -> `phase in leaguePhases`
7. Update option placeholder (line 823): "Select Round" -> "Select Phase"

IMPORTANT: The `newMatch.round` property must stay as `round` because the API and database use `round` for match records (matches table has round column, not phase). Only the user-visible LABELS change.
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Check that PairingsView has no `selectedRound` references.
Check that MatchesView has no `leagueRounds` references.
  </verify>
  <done>
PairingsView uses selectedPhase internally, MatchesView uses leaguePhases for iteration, user-visible labels show "Phase".
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` passes without errors
2. `npm run dev` starts successfully
3. No console errors when navigating to /armies, /players, /pairings, /matches pages
4. Grep verification: `grep -r "currentRound\|selectedRound\|leagueRounds" app/components/views/ app/pages/armies.vue app/pages/players.vue app/composables/useArmyFiltering.js` returns no matches (except for match.round which is intentional)
</verification>

<success_criteria>
1. All component props renamed: currentRound->currentPhase, rounds->phases
2. All composable exports renamed: selectedRound->selectedPhase, setRoundFilter->setPhaseFilter, getArmyCountForRound->getArmyCountForPhase
3. All parent pages updated with new prop bindings
4. Application compiles and runs without errors
5. Internal component refs use phase terminology
</success_criteria>

<output>
After completion, create `.planning/phases/04-user-interface/04-01-SUMMARY.md`
</output>

---
phase: 02-api-layer
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - server/api/matches.post.ts
  - server/api/admin/matches/[id].put.ts
  - server/api/admin/matches/all.get.ts
  - server/api/admin/phases/[id].put.ts
autonomous: true

must_haves:
  truths:
    - "Match creation API accepts 'phase' in request body"
    - "Match update API accepts 'phase' in request body"
    - "Match listing API returns 'phase' in response"
    - "Admin phases route is /api/admin/phases/:id"
  artifacts:
    - path: "server/api/matches.post.ts"
      provides: "Match creation with phase terminology"
      contains: "body.phase"
    - path: "server/api/admin/matches/[id].put.ts"
      provides: "Match update with phase terminology"
      contains: "body.phase"
    - path: "server/api/admin/matches/all.get.ts"
      provides: "Match listing with phase terminology"
      contains: "phase: matches.phase"
    - path: "server/api/admin/phases/[id].put.ts"
      provides: "Phase admin endpoint at correct route"
  key_links:
    - from: "server/api/matches.post.ts"
      to: "db/schema.ts"
      via: "matches.phase and pairings.phase column references"
      pattern: "matches\\.phase|pairings\\.phase"
    - from: "server/api/admin/phases/[id].put.ts"
      to: "/api/admin/phases/:id"
      via: "Nuxt file-based routing"
      pattern: "admin/phases"
---

<objective>
Update match API handlers to use "phase" terminology and rename admin rounds folder to phases.

Purpose: Complete the API layer rename for match endpoints and admin route, ensuring all API paths use phase terminology.
Output: 3 updated API handler files + 1 folder rename
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-api-layer/02-RESEARCH.md
@db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update matches API handlers</name>
  <files>
    server/api/matches.post.ts
    server/api/admin/matches/[id].put.ts
    server/api/admin/matches/all.get.ts
  </files>
  <action>
    In server/api/matches.post.ts:
    - Change `body.round` to `body.phase` in validation (line ~15)
    - Change error message from "round" to "phase" (line ~18)
    - Change `round: body.round` to `phase: body.phase` in insert values (line ~52)
    - Change `body.round` to `body.phase` in pairing update condition (line ~87)
    - Change `pairings.round` to `pairings.phase` in where clauses (lines ~95, 110)

    In server/api/admin/matches/[id].put.ts:
    - Change `body.round` to `body.phase` (line ~29)
    - Change `updateData.round` to `updateData.phase` (line ~29)

    In server/api/admin/matches/all.get.ts:
    - Change `round: matches.round` to `phase: matches.phase` in select (line ~23)
  </action>
  <verify>
    Run `npx tsc --noEmit server/api/matches.post.ts server/api/admin/matches/[id].put.ts server/api/admin/matches/all.get.ts` - should pass with no errors
  </verify>
  <done>
    All three match API files use phase terminology in request parsing, Drizzle queries, and responses
  </done>
</task>

<task type="auto">
  <name>Task 2: Rename admin rounds folder to phases</name>
  <files>
    server/api/admin/phases/[id].put.ts
  </files>
  <action>
    Rename the folder:
    - Move `server/api/admin/rounds/` to `server/api/admin/phases/`
    - This changes the API route from `/api/admin/rounds/:id` to `/api/admin/phases/:id`

    The file content (server/api/admin/rounds/[id].put.ts) is already updated to use phase terminology from Phase 1, so only the folder rename is needed.

    Use: `mv server/api/admin/rounds server/api/admin/phases`
  </action>
  <verify>
    1. Verify folder exists: `ls server/api/admin/phases/[id].put.ts`
    2. Verify old folder removed: `ls server/api/admin/rounds/` should fail
    3. TypeScript check: `npx tsc --noEmit server/api/admin/phases/[id].put.ts`
  </verify>
  <done>
    Admin phases endpoint accessible at /api/admin/phases/:id, old rounds folder no longer exists
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` passes for all modified files
2. Folder verification: `server/api/admin/phases/` exists, `server/api/admin/rounds/` does not exist
3. Grep verification: `grep -r "\.round" server/api/matches.post.ts server/api/admin/matches/` returns no matches
4. Route verification: File-based routing will now serve /api/admin/phases/:id
</verification>

<success_criteria>
- All 3 match API handler files compile without TypeScript errors
- Admin rounds folder renamed to phases
- No references to `body.round`, `matches.round`, or `pairings.round` remain in these files
- API route /api/admin/phases/:id is available (via file-based routing)
</success_criteria>

<output>
After completion, create `.planning/phases/02-api-layer/02-02-SUMMARY.md`
</output>
